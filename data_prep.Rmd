---
title: "Data prep"
author: "Mathijn Wilkens"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  html_document: 
    css: custom.css
    toc: true
    toc_float: true
---

```{r include=FALSE}
library(lavaan)
library(semTools)
library(semPlot)
```

#Subsetting data
Dataset 'EWCS' created with 'import_data.R'. The analysis will not cover any years before 2000 so that data can be excluded. It will also only cover the EU28 of 2015.

```{r}
load("data/EWCS.Rda")

EWCS_EU28 <- subset(EWCS, EU_x==1 & as.numeric(wave)>=3)

EWCS_EU28$wave <- droplevels(EWCS_EU28$wave)
EWCS_EU28$countid <- droplevels(EWCS_EU28$countid)

```

#Recodes

```{r}
#year
EWCS_EU28$t <- as.numeric(EWCS_EU28$wave)

#yeardummies
d <- as.data.frame(model.matrix( ~ wave - 1, data=EWCS_EU28 ))
colnames(d) <- c("w2000","w2005","w2010","w2015")
EWCS_EU28 <- cbind(EWCS_EU28,d)
rm(d)

#working with computers
EWCS_EU28$y15_Q30i <- ordered(EWCS_EU28$y15_Q30i, levels=rev(levels(EWCS_EU28$y15_Q30i)))
EWCS_EU28$computer <- as.numeric(EWCS_EU28$y15_Q30i)

#Age
EWCS_EU28$age <- as.numeric(levels(EWCS_EU28$y15_Q2b))[EWCS_EU28$y15_Q2b]

#gender
EWCS_EU28$woman <- as.numeric(EWCS_EU28$y15_Q2a)-1

#ISCO08_1d (2010 & 2005)
EWCS_EU28$y15_isco_08_1 <- factor(EWCS_EU28$y15_isco_08_1, levels=c("Managers","Professionals","Technicians and associate professionals","Clerical support workers","Service and sales workers","Skilled agricultural, forestry and fishery workers","Craft and related trades workers","Plant and machine operators, and assemblers","Elementary occupations","Armed forces occupations"))

EWCS_EU28$ISCO_d1[EWCS_EU28$y15_isco_08_1=="Managers"] <- 1
EWCS_EU28$ISCO_d1[EWCS_EU28$y15_isco_08_1!="Managers"] <- 0
EWCS_EU28$ISCO_d2[EWCS_EU28$y15_isco_08_1=="Professionals"] <- 1
EWCS_EU28$ISCO_d2[EWCS_EU28$y15_isco_08_1!="Professionals"] <- 0
EWCS_EU28$ISCO_d3[EWCS_EU28$y15_isco_08_1=="Technicians and associate professionals"] <- 1
EWCS_EU28$ISCO_d3[EWCS_EU28$y15_isco_08_1!="Technicians and associate professionals"] <- 0
EWCS_EU28$ISCO_d4[EWCS_EU28$y15_isco_08_1=="Clerical support workers"] <- 1
EWCS_EU28$ISCO_d4[EWCS_EU28$y15_isco_08_1!="Clerical support workers"] <- 0
EWCS_EU28$ISCO_d5[EWCS_EU28$y15_isco_08_1=="Service and sales workers"] <- 1
EWCS_EU28$ISCO_d5[EWCS_EU28$y15_isco_08_1!="Service and sales workers"] <- 0
EWCS_EU28$ISCO_d6[EWCS_EU28$y15_isco_08_1=="Skilled agricultural, forestry and fishery workers"] <- 1
EWCS_EU28$ISCO_d6[EWCS_EU28$y15_isco_08_1!="Skilled agricultural, forestry and fishery workers"] <- 0
EWCS_EU28$ISCO_d7[EWCS_EU28$y15_isco_08_1=="Craft and related trades workers"] <- 1
EWCS_EU28$ISCO_d7[EWCS_EU28$y15_isco_08_1!="Craft and related trades workers"] <- 0
EWCS_EU28$ISCO_d8[EWCS_EU28$y15_isco_08_1=="Plant and machine operators, and assemblers"] <- 1
EWCS_EU28$ISCO_d8[EWCS_EU28$y15_isco_08_1!="Plant and machine operators, and assemblers"] <- 0
EWCS_EU28$ISCO_d9[EWCS_EU28$y15_isco_08_1=="Elementary occupations"] <- 1
EWCS_EU28$ISCO_d9[EWCS_EU28$y15_isco_08_1!="Elementary occupations"] <- 0

#ISCO88 (2000)
#EWCS_EU28$y15_ISCO_88_1
#EWCS_EU28$y15_ISCO_88_2

#Education
EWCS_EU28$edu_low <- as.numeric(EWCS_EU28$education=="primary")
EWCS_EU28$edu_high <- as.numeric(EWCS_EU28$education=="tertiary")

#Frequent disruptive interruptions
EWCS_EU28$freq_dis_int <- as.ordered(EWCS_EU28$freq_dis_int)

#High speed
EWCS_EU28$y15_Q49a <- factor(EWCS_EU28$y15_Q49a, 
                             levels=c("Never                  ",
                                      "Almost never           ",
                                      "Around ¼ of the time   ",
                                      "Around half of the time",
                                      "Around ¾ of the time   ",
                                      "Almost all of the time ",
                                      "All of the time        "), 
                             ordered=TRUE)

#Tight deadlines
EWCS_EU28$y15_Q49b <- factor(EWCS_EU28$y15_Q49b, 
                             levels=c("Never                  ",
                                      "Almost never           ",
                                      "Around ¼ of the time   ",
                                      "Around half of the time",
                                      "Around ¾ of the time   ",
                                      "Almost all of the time ",
                                      "All of the time        "), 
                             ordered=TRUE)

#Not enough time to get the job done
EWCS_EU28$y15_Q61g <- factor(EWCS_EU28$y15_Q61g, 
                             levels=c("Always                       ",
                                      "Most of the time             ",
                                      "Sometimes                    ",
                                      "Rarely                       ",
                                      "Never                        ")
                             , ordered=TRUE)

#Working hours
#totalhour

#Work in free time
EWCS_EU28$y15_Q46_r <- factor(EWCS_EU28$y15_Q46, 
                              levels=c("Never                        ",
                                       "Less often                   ",
                                       "Several times a month        ",
                                       "Several times a week         ",
                                       "Daily                        ")
                              , ordered=TRUE)

#Hour or two off
EWCS_EU28$y15_Q47 <- ordered(EWCS_EU28$y15_Q47, levels=rev(levels(EWCS_EU28$y15_Q47)))

#Autonomy
EWCS_EU28$y15_Q54a <- factor(EWCS_EU28$y15_Q54a, 
                             levels=c("No                        ",
                                                          "Yes                       "), 
                             ordered=TRUE)
EWCS_EU28$y15_Q54b <- factor(EWCS_EU28$y15_Q54b, 
                             levels=c("No                        ",
                                                          "Yes                       "), 
                             ordered=TRUE)
EWCS_EU28$y15_Q54c <- factor(EWCS_EU28$y15_Q54c, 
                             levels=c("No                        ",
                                                          "Yes                       "), 
                             ordered=TRUE)

EWCS_EU28$y15_Q61e <- factor(EWCS_EU28$y15_Q61e, levels=rev(levels(EWCS_EU28$y15_Q61e)), ordered=TRUE)

#Cognitive dimension
#Solving unforeseen problems
EWCS_EU28$y15_Q53c <- ordered(EWCS_EU28$y15_Q53c, levels=rev(levels(EWCS_EU28$y15_Q53c)))

#Carrying out complex tasks
EWCS_EU28$y15_Q53e <- ordered(EWCS_EU28$y15_Q53e, levels=rev(levels(EWCS_EU28$y15_Q53e)))

#Learning new things
EWCS_EU28$y15_Q53f <- ordered(EWCS_EU28$y15_Q53f, levels=rev(levels(EWCS_EU28$y15_Q53f)))

#apply own ideas
EWCS_EU28$y15_Q61i <- ordered(EWCS_EU28$y15_Q61i, levels=rev(levels(EWCS_EU28$y15_Q61i)))

#Social support
EWCS_EU28$y15_Q61a <- ordered(EWCS_EU28$y15_Q61a, levels=rev(levels(EWCS_EU28$y15_Q61a)))
EWCS_EU28$y15_Q61b <- ordered(EWCS_EU28$y15_Q61b, levels=rev(levels(EWCS_EU28$y15_Q61b)))

#WHO5
EWCS_EU28$y15_Q87a <- ordered(EWCS_EU28$y15_Q87a, levels=rev(levels(EWCS_EU28$y15_Q87a)))
EWCS_EU28$y15_Q87b <- ordered(EWCS_EU28$y15_Q87b, levels=rev(levels(EWCS_EU28$y15_Q87b)))
EWCS_EU28$y15_Q87c <- ordered(EWCS_EU28$y15_Q87c, levels=rev(levels(EWCS_EU28$y15_Q87c)))
EWCS_EU28$y15_Q87d <- ordered(EWCS_EU28$y15_Q87d, levels=rev(levels(EWCS_EU28$y15_Q87d)))
EWCS_EU28$y15_Q87e <- ordered(EWCS_EU28$y15_Q87e, levels=rev(levels(EWCS_EU28$y15_Q87e)))

#health in general
EWCS_EU28$y15_Q75 <- ordered(EWCS_EU28$y15_Q75, levels=rev(levels(EWCS_EU28$y15_Q75)))

#Anxiety
EWCS_EU28$anxiety <- ordered(EWCS_EU28$y15_Q78h_lt, levels=levels(EWCS_EU28$y15_Q78h_lt))

#Fatigue
EWCS_EU28$fatigue <- ordered(EWCS_EU28$y15_Q78i_lt, levels=rev(levels(EWCS_EU28$y15_Q78i_lt)))

#headache/eyestrain
EWCS_EU28$headeye <- ordered(EWCS_EU28$y15_Q78f_lt, levels=rev(levels(EWCS_EU28$y15_Q78f_lt)))

#Stress
EWCS_EU28$stress  <- ordered(EWCS_EU28$y15_Q61m, levels=rev(levels(EWCS_EU28$y15_Q61m)))

#absenteeism /presenteeism
EWCS_EU28$absenteeism <- ordered(EWCS_EU28$absenteeism)

EWCS_EU28$presenteeism <- ordered(EWCS_EU28$presenteeism)

```

